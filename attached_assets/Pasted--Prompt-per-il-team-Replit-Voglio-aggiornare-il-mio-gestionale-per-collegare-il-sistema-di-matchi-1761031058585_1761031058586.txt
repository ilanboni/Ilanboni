ğŸ§© Prompt per il team Replit

Voglio aggiornare il mio gestionale per collegare il sistema di matching automatico immobili-clienti con la visualizzazione diretta dei risultati nelle schede clienti e nelle schede immobili pluricondivisi.

Al momento il sistema ha giÃ :

lâ€™algoritmo di matching in server/lib/matchingLogic.ts

le pagine /clients/[id]/search e /properties/shared/[id]

le tabelle properties, clients, tasks, interactions

gli endpoint /api/run/scan e /api/run/match che generano i task giornalieri (giÃ  configurati con GitHub Actions)

Ora serve far vedere i risultati e i task generati direttamente nel gestionale, cosÃ¬:

ğŸ”¹ Scheda Cliente (/clients/[id])

Aggiungere:

Box â€œMatching di oggiâ€
mostra tutti i match generati da /api/run/match per quel cliente (ultimo giorno).

dati richiesti: property_id, title, address, price_eur, score, type (WHATSAPP_SEND / CALL_OWNER / CALL_AGENCY), url

endpoint da creare:
GET /api/clients/:id/matches?since=today

Box â€œTask apertiâ€
lista dei task ancora status=open legati a quel cliente.

endpoint:
GET /api/clients/:id/tasks?status=open

Box â€œCronologia inviiâ€
storico interactions per quel cliente (ultimi 30 giorni).

endpoint:
GET /api/clients/:id/interactions?since=30d

ğŸ”¹ Scheda Immobile Pluricondiviso (/properties/shared/[id])

Aggiungere:

Box â€œClienti interessatiâ€
mostra i clienti con punteggio >= soglia e tipo di task associato.

endpoint:
GET /api/properties/:id/matches?since=today

Box â€œTask aperti su questo immobileâ€
elenco dei task status=open per quellâ€™immobile.

endpoint:
GET /api/properties/:id/tasks?status=open

Box â€œCronologia azioniâ€
elenco di interactions legate allâ€™immobile (ultimi 30 giorni).

endpoint:
GET /api/properties/:id/interactions?since=30d

Pipeline visiva di avanzamento
mostra la fase del processo (INDIRIZZO_TROVATO â†’ PROPRIETARIO_IDENTIFICATO â†’ CONTATTO_REPERITO â†’ CONTATTATO â†’ ESITO)

endpoint:
GET /api/properties/:id/pipeline

ğŸ”¹ Regole operative

Tutti gli endpoint leggono le tabelle giÃ  esistenti (tasks, interactions, properties, clients)

Lato frontend usare React/Next (giÃ  presente nel gestionale) con componenti nuovi:

ClientMatchesToday

ClientOpenTasks

PropertyInterestedClients

PropertyPipeline

I match sono filtrati solo per la data (since=today) o ultimi 30 giorni per le interazioni.

I task mostrano link WhatsApp (campo notes) o portale.

ğŸ”¹ Obiettivo finale

Quando il cron giornaliero GitHub Actions lancia /api/run/match:

i task e le interazioni vengono scritti nel DB

il giorno dopo, entrando in una scheda cliente o pluricondiviso, vedo subito i nuovi match, i task aperti e lo storico invii

ğŸ‘‰ Richiesta per Replit
Chiedo di:

confermare come il gestionale attuale gestisce giÃ  /clients/[id] e /properties/shared/[id]

spiegare come Ã¨ costruito il backend API (framework e struttura file)

indicare dove conviene aggiungere i nuovi endpoint elencati sopra

dirmi se serve un adapter o mapping diverso per leggere tasks e interactions dal DB